# Simple Unified YAML Example
# Demonstrates the most basic usage: single connection, single task, inline validation
#
# This example shows how to:
# - Define a connection with environment variables
# - Generate data for a PostgreSQL table
# - Add inline validations (just like the Scala API!)

name: "simple_customer_data"
description: "Generate customer data with validation"

# Define reusable connections
connections:
  - name: customer_db
    type: postgres
    options:
      url: "jdbc:postgresql://${DB_HOST:-localhost}:${DB_PORT:-5432}/${DB_NAME:-customer}"
      user: "${DB_USER:-postgres}"
      password: "${DB_PASSWORD:-postgres}"
      driver: "org.postgresql.Driver"

# Define tasks with inline steps - everything in one place!
tasks:
  - name: generate_customers
    dataSourceName: customer_db  # Reference the connection by name
    enabled: true

    # Steps defined inline in the task!
    steps:
      - name: customers
        type: postgres
        options:
          dbtable: "public.customers"
        count:
          records: 1000
        fields:
          - name: customer_id
            type: string
            options:
              regex: "CUST[0-9]{6}"
              unique: true

          - name: email
            type: string
            options:
              faker: "#{Internet.emailAddress}"

          - name: first_name
            type: string
            options:
              faker: "#{Name.firstName}"

          - name: last_name
            type: string
            options:
              faker: "#{Name.lastName}"

          - name: age
            type: integer
            options:
              min: 18
              max: 90

          - name: balance
            type: decimal
            options:
              min: 0
              max: 10000

          - name: status
            type: string
            options:
              oneOf: ["active", "inactive", "suspended"]

          - name: created_date
            type: date
            options:
              faker: "#{Date.birthday}"

        # Inline validations - same level as fields and count!
        validations:
          # Field-level validations
          - field: customer_id
            validation:
              - type: unique
              - type: "null"
                negate: true

          - field: email
            validation:
              - type: matches
                regex: "^[A-Za-z0-9+_.-]+@(.+)$"

          - field: age
            validation:
              - type: between
                min: 18
                max: 90

          - field: balance
            validation:
              - type: greaterThan
                value: 0
                strictly: false

          - field: status
            validation:
              - type: in
                values: ["active", "inactive", "suspended"]

          # Expression validations
          - expr: "age >= 18"
            description: "All customers must be adults"

          - expr: "balance >= 0"
            description: "Balance cannot be negative"

          # Count validation
          - metric: "count"
            validation:
              - type: equal
                value: 1000

# Optional: Plan-level configuration
configuration:
  flags:
    enableFastGeneration: true
    enableValidation: true
  folders:
    generatedReportsFolderPath: "/tmp/data-caterer/reports"
